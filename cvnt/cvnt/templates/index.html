<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Secret Endpoint Slay</title>

    <!--<link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">-->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- Leaflet CSS -->
    <link href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" rel="stylesheet">
    <!-- Custom CSS -->
    <style>
        #map-container {
            position: relative;
        }
        #map {
            height: 500px;
            width: 100%;
        }
        .sidebar {
            position: absolute;
            top: 20px; /* Adjust as needed */
            right: 20px; /* Adjust as needed */
            background-color: #f8f9fa;
            padding: 20px;
            z-index: 1000;
            display: none;
        }
        .marker-info {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>

  <header>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="../client">Terminal and Map</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="../explorer">File explorer</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="../terminal">Terminal</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  <div class="px-4 pt-5 my-3 text-center border-bottom">
    <div class="pb-3">
      <h1 class="display-4 fw-bold">Implants Online</h1>
    </div>
    <div class="col-lg-6 mx-auto">
      <p class="mb-4 pb-3">
        Wow gurls youre really killing the game out here. look at all these losers falling victim to your
        quick wit and overall charm. Social engineering and implanting on everyone. The world better watch
        out for you!
      </p>
    </div>
  </div>

<div id="map-container" class="container-fluid">
    <div class="row">
        <div class="col">
            <div id="map"></div>
            <div class="sidebar" id="sidebar">
                <!-- Marker info will be inserted here -->
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

<script>
  var map = L.map('map');
  var sidebar = $('#sidebar');

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
  }).addTo(map);

  var implantCoordinates = {{ implant_coordinates | tojson }};
  var implantTasks = {{implant_tasks | tojson}}
  var markers = [];

  implantCoordinates.forEach(function(coord) {
      var markerIcon = L.icon({
          iconUrl: '../static/img/implant.png', // Customize this URL to your marker icon
          iconSize: [25, 45], // Default icon size
          iconAnchor: [12, 41], // Default icon anchor
          popupAnchor: [1, -34], // Default popup anchor
      });

      var marker = L.marker([coord[0], coord[1]], {icon: markerIcon});
      marker.on('click', function() {
          sidebar.html('<h3>Implant ID: ' + coord[2] + '</h3>' +
                       '<p>Latitude: ' + coord[0] + '</p>' +
                       '<p>Longitude: ' + coord[1] + '</p>');

          // Display tasks associated with the current implant
          var tasksHTML = '<h4>Tasks:</h4>';
          implantTasks.forEach(function(implantTask) {
              if (implantTask.implant_id === coord[2]) {
                  tasksHTML += '<div class="task-info">';
                  tasksHTML += '<p>Task ID: ' + implantTask.task_id + '</p>';
                  tasksHTML += '<p>Status: ' + implantTask.status + '</p>';
                  tasksHTML += '<p>Opcode: ' + implantTask.task_opcode + '</p>';
                  tasksHTML += '<p>Args: ' + implantTask.task_args + '</p>';
                  tasksHTML += '<p>Output: ' + implantTask.task_output + '</p>';
                  tasksHTML += '</div>';
              }
          });
          sidebar.append(tasksHTML);

          sidebar.show();
      });
      markers.push(marker);
  });

  var group = L.featureGroup(markers).addTo(map);
  map.fitBounds(group.getBounds());
</script>

</body>
</html>
